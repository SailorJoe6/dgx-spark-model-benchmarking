#!/usr/bin/env bash
set -euo pipefail

ROOT="$(git rev-parse --show-toplevel)"
VENV_PY="$ROOT/work/swebench/.venv/bin/python"

if [[ ! -x "$VENV_PY" ]]; then
  echo "ERROR: Expected venv python at $VENV_PY" >&2
  echo "Create the venv in work/swebench/.venv and install dependencies." >&2
  exit 1
fi

echo "Running repo unit tests..."
"$VENV_PY" -m unittest discover -s "$ROOT/tests" -v

echo "Running mini-swe-agent pytest..."
(
  cd "$ROOT/work/swebench/mini-swe-agent"
  "$VENV_PY" -m pytest -q
)
