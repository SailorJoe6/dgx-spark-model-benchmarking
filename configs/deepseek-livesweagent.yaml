# Config template based on mini-swe-agent swebench.yaml with local vLLM settings

agent:
  system_template: |
    You are a helpful assistant that can interact with a computer shell to solve programming tasks.
  instance_template: |
    <pr_description>
    Consider the following PR description:
    {{task}}
    </pr_description>

    <instructions>
    # Task Instructions

    ## Overview

    You're a software engineer interacting continuously with a computer by submitting commands.
    You'll be helping implement necessary changes to meet requirements in the PR description.
    Your task is specifically to make changes to non-test files in the current directory in order to fix the issue described in the PR description in a way that is general and consistent with the codebase.
    <IMPORTANT>This is an interactive process where you will think and issue AT LEAST ONE command, see the result, then think and issue your next command(s).</important>

    For each response:

    1. Include a THOUGHT section explaining your reasoning and what you're trying to accomplish
    2. Provide exactly ONE bash command to execute

    ## Important Boundaries

    - MODIFY: Regular source code files in /testbed (this is the working directory for all your subsequent commands)
    - DO NOT MODIFY: Tests, configuration files (pyproject.toml, setup.cfg, etc.)

    ## Recommended Workflow

    1. Analyze the codebase by finding and reading relevant files
    2. Run the FAIL_TO_PASS tests (or the smallest relevant test subset) and record which tests fail
    3. Edit the source code to resolve the issue
    4. Verify your fix works by re-running the FAIL_TO_PASS tests
    5. Test edge cases to ensure your fix is robust

    ## Test Requirements (MANDATORY)
    - You MUST run the FAIL_TO_PASS tests or the smallest relevant test subset for the issue.
    - If running the full test suite is feasible, you SHOULD do so, but do not block progress on it.
    - You must consider test results in the context of the PR description before submitting.
    - Keep working until test results clearly indicate the PR is fixed.


    ## Command Execution Rules

    You are operating in an environment where

    1. You issue at least one command
    3. The system executes the command(s) in a subshell
    4. You see the result(s)
    5. You write your next command(s)

    Each response should include:

    1. **Reasoning text** where you explain your analysis and plan
    2. At least one tool call with your command

    **CRITICAL REQUIREMENTS:**

    - Your response SHOULD include reasoning text explaining what you're doing
    - Your response MUST include AT LEAST ONE bash tool call
    - Directory or environment variable changes are not persistent. Every action is executed in a new subshell.
    - However, you can prefix any action with `MY_ENV_VAR=MY_VALUE cd /path/to/working/dir && ...` or write/load environment variables from files

    Example of a CORRECT response:
    <example_response>
    I need to understand the structure of the repository first. Let me check what files are in the current directory to get a better understanding of the codebase.

    [Makes bash tool call with {"command": "ls -la"} as arguments]
    </example_response>

    ## Environment Details

    - You have a full Linux shell environment
    - Always use non-interactive flags (-y, -f) for commands
    - Avoid interactive tools like vi, nano, or any that require user input
    - You can use bash commands or invoke any tool that is available in the environment
    - You can also create new tools or scripts to help you with the task
    - If a tool isn't available, you can also install it

    ## Submission

    When you've completed your work, you MUST submit your changes as a git patch.
    Follow these steps IN ORDER, with SEPARATE commands:

    <IMPORTANT>
    The patch must only contain changes to the specific source files you modified to fix the issue.
    Do not submit file creations or changes to any of the following files:

    - test and reproduction files
    - helper scripts, tests, or tools that you created
    - installation, build, packaging, configuration, or setup scripts unless they are directly part of the issue you were fixing (you can assume that the environment is already set up for your client)
    - binary or compiled files
    </IMPORTANT>

    Step 1: Submit (EXACT command required)
    You MUST use this EXACT command to submit:

    ```bash
    echo COMPLETE_TASK_AND_SUBMIT_FINAL_OUTPUT && git diff --cached
    ```

    If the command fails (nonzero exit status), it will not submit.

    <CRITICAL>
    - Submitting MUST be a separate command (not combined with other actions).
    - You CANNOT continue working (reading, editing, testing) in any way on this task after submitting.
    </CRITICAL>
    </instructions>
  step_limit: 250
  cost_limit: 3.

environment:
  cwd: "/testbed"
  timeout: 1800
  env:
    PAGER: cat
    MANPAGER: cat
    LESS: -R
    PIP_PROGRESS_BAR: 'off'
    TQDM_DISABLE: '1'
  environment_class: docker
  run_args:
    - "--rm"
    - "--platform=linux/amd64"

model:
  model_name: "hosted_vllm/deepseek-ai/DeepSeek-Coder-V2-Lite-Instruct"
  model_class: "litellm"
  cost_tracking: "ignore_errors"
  use_streaming: true
  observation_template: |
    {%- if output.output | length < 10000 -%}
    {
      "returncode": {{ output.returncode }},
      "output": {{ output.output | tojson }}
      {%- if output.exception_info %}, "exception_info": {{ output.exception_info | tojson }}{% endif %}
    }
    {%- else -%}
    {
      "returncode": {{ output.returncode }},
      "output_head": {{ output.output[:5000] | tojson }},
      "output_tail": {{ output.output[-5000:] | tojson }},
      "elided_chars": {{ output.output | length - 10000 }},
      "warning": "Output too long."
      {%- if output.exception_info %}, "exception_info": {{ output.exception_info | tojson }}{% endif %}
    }
    {%- endif -%}
  format_error_template: |
    Tool call error. Every response needs to use the 'bash' tool at least once to execute commands.

    Call the bash tool with your command as the argument:
    - Tool: bash
    - Arguments: {"command": "your_command_here"}

    If you have completed your assignment, please consult the first message about how to
    submit your solution (you will not be able to continue working on this task after that).
  model_kwargs:
    max_completion_tokens: 65536
    # stop:
    #   - "</files>"
    #   - "</output>"
    #   - "</instructions>"
    #   - "</instructions>/n"
    drop_params: true
    temperature: 0.0
    api_base: "http://localhost:8000/v1"
